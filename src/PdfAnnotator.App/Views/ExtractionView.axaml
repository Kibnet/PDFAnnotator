<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="PdfAnnotator.App.Views.ExtractionView"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:viewmodels="using:PdfAnnotator.App.ViewModels"
             d:DesignHeight="1000"
             d:DesignWidth="1200"
             x:DataType="viewmodels:ExtractionViewModel">
    <Grid ColumnDefinitions="500,*" RowDefinitions="Auto,*">
        <StackPanel Margin="12" Spacing="8">
            <TextBlock Text="Режим: извлечение" FontWeight="Bold"/>
            <TextBox Watermark="Путь к PDF" Text="{Binding PdfPath, UpdateSourceTrigger=PropertyChanged}"/>
            <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Content="Открыть PDF" Click="OnOpenPdfClick" Command="{Binding LoadPdfCommand}"/>
                <TextBlock Text="{Binding PageCount, StringFormat='Страниц: {0}'}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock Text="Страница"/>
                <NumericUpDown Width="180" Minimum="1" Maximum="{Binding PageCount}" Value="{Binding CurrentPage}"/>
                <TextBlock Text="DPI"/>
                <NumericUpDown Width="180" Minimum="50" Maximum="600" Increment="10" Value="{Binding Dpi}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock Text="Пресет"/>
                <ComboBox Width="160" ItemsSource="{Binding Presets}" SelectedItem="{Binding SelectedPreset}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
                <Button Content="Обновить" Command="{Binding ReloadPresetsCommand}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Content="Сохранить пресет" Command="{Binding SavePresetCommand}"/>
				<Button Content="Загрузить пресет" Command="{Binding LoadPresetCommand}"/>
				<Button Content="Извлечь текст" Command="{Binding ExtractTextCommand}"/>
            </StackPanel>
            <StackPanel>
                <TextBlock Text="Прямоугольник (PDF координаты):"/>
                <TextBlock Text="{Binding X0, StringFormat='X0: {0:F1}'}"/>
                <TextBlock Text="{Binding Y0, StringFormat='Y0: {0:F1}'}"/>
                <TextBlock Text="{Binding X1, StringFormat='X1: {0:F1}'}"/>
                <TextBlock Text="{Binding Y1, StringFormat='Y1: {0:F1}'}"/>
            </StackPanel>
            <!-- Text Preview Section -->
            <StackPanel>
                <TextBlock Text="Предварительный просмотр извлеченного текста:" FontWeight="Bold"/>
                <TextBox Text="{Binding ExtractedTextPreview}" 
                         MinHeight="100" 
                         MaxHeight="200" 
                         IsReadOnly="True" 
                         TextWrapping="Wrap" 
                         ScrollViewer.VerticalScrollBarVisibility="Auto"/>
            </StackPanel>
        </StackPanel>

        <Border Grid.Column="1" Margin="12" Background="Gray">
            <Viewbox Stretch="Uniform">
                <Grid Width="{Binding PageBitmap.PixelSize.Width}" Height="{Binding PageBitmap.PixelSize.Height}">
                    <Image x:Name="PageImage"
                           Source="{Binding PageBitmap}"
                           Stretch="Fill"
                           PointerPressed="OnPointerPressed"
                           PointerReleased="OnPointerReleased"
                           PointerMoved="OnPointerMoved"/>
                    <Canvas IsHitTestVisible="False"
                            Width="{Binding #PageImage.Bounds.Width}"
                            Height="{Binding #PageImage.Bounds.Height}">
                        <Rectangle Stroke="Orange" StrokeThickness="2"
                                   Canvas.Left="{Binding SelectLeft}"
                                   Canvas.Top="{Binding SelectTop}"
                                   Width="{Binding SelectWidth}"
                                   Height="{Binding SelectHeight}"
                                   Fill="#40FFA500"/>
                    </Canvas>
                </Grid>
            </Viewbox>
        </Border>
    </Grid>
</UserControl>