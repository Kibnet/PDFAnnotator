<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="PdfAnnotator.App.Views.ExtractionView"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:viewmodels="using:PdfAnnotator.App.ViewModels"
             d:DesignHeight="1000"
             d:DesignWidth="1200"
             x:DataType="viewmodels:ExtractionViewModel">
    <Grid ColumnDefinitions="380,*">
        <Border Grid.Column="0" Padding="10" Background="#0D000000">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Spacing="10">


                    <Border Padding="8" Background="#08000000" CornerRadius="4">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Документ" FontWeight="SemiBold"/>
                            <TextBox Watermark="Путь к PDF"
                                     Text="{Binding PdfPath, UpdateSourceTrigger=PropertyChanged}"
                                     HorizontalAlignment="Stretch"/>
                            <WrapPanel ItemSpacing="8" VerticalAlignment="Center">
                                <Button Content="Открыть PDF" Click="OnOpenPdfClick" Command="{Binding LoadPdfCommand}"/>
                                <TextBlock Text="{Binding PageCount, StringFormat='Страниц: {0}'}"
                                           VerticalAlignment="Center"/>
                                <NumericUpDown Minimum="1" FormatString="N0" AllowSpin="True"
                                               Maximum="{Binding PageCount}"
                                               Value="{Binding CurrentPage}"/>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <Border Padding="8" Background="#08000000" CornerRadius="4">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Пресеты" FontWeight="SemiBold"/>
                            <WrapPanel ItemSpacing="8">
                                <ComboBox MinWidth="180"
                                          ItemsSource="{Binding Presets}"
                                          SelectedItem="{Binding SelectedPreset}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Name}"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <Button ToolTip.Tip="Обновить" Command="{Binding ReloadPresetsCommand}">
                                    <TextBlock Text="🔄"/>
                                </Button>
                            </WrapPanel>
                            <TextBox Watermark="Имя пресета"
                                     Text="{Binding PresetName, UpdateSourceTrigger=PropertyChanged}"
                                     HorizontalAlignment="Stretch"/>
                            <WrapPanel ItemSpacing="8">
                                <Button ToolTip.Tip="Сохранить" Command="{Binding SavePresetCommand}">
                                    <TextBlock Text="💾"/>
                                </Button>
                                <Button ToolTip.Tip="Загрузить" Command="{Binding LoadPresetCommand}">
                                    <TextBlock Text="📂"/>
                                </Button>
                                <Button ToolTip.Tip="Переименовать" Command="{Binding RenamePresetCommand}">
                                    <TextBlock Text="✏"/>
                                </Button>
                                <Button ToolTip.Tip="Удалить" Command="{Binding DeletePresetCommand}">
                                    <TextBlock Text="🗑"/>
                                </Button>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <Border Padding="8" Background="#08000000" CornerRadius="4">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Выделение" FontWeight="SemiBold"/>
                            <WrapPanel ItemSpacing="12">
                                <StackPanel Spacing="2">
                                    <TextBlock Text="X0" Foreground="#808080"/>
                                    <TextBlock Text="{Binding X0, StringFormat=N2}"/>
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Y0" Foreground="#808080"/>
                                    <TextBlock Text="{Binding Y0, StringFormat=N2}"/>
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="X1" Foreground="#808080"/>
                                    <TextBlock Text="{Binding X1, StringFormat=N2}"/>
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Y1" Foreground="#808080"/>
                                    <TextBlock Text="{Binding Y1, StringFormat=N2}"/>
                                </StackPanel>
                            </WrapPanel>
                            <StackPanel Spacing="4">
                                <TextBlock Text="Направление текста" FontWeight="SemiBold"/>
                                <ComboBox ItemsSource="{Binding DirectionOptions}"
                                          SelectedValue="{Binding Direction}"
                                          MinWidth="260">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Title}"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <CheckBox Content="Добавлять пробелы между словами"
                                          IsChecked="{Binding AddSpacesBetweenWords}"/>
                            </StackPanel>
                            <Button Content="Извлечь текст" Background="ForestGreen" Command="{Binding ExtractTextCommand}" HorizontalAlignment="Stretch"/>
                        </StackPanel>
                    </Border>

                    <Border Padding="8" Background="#08000000" CornerRadius="4">
                        <StackPanel Spacing="6">
                            <TextBlock Text="Предпросмотр текста" FontWeight="SemiBold"/>
                            <TextBox Text="{Binding ExtractedTextPreview}"
                                     MaxHeight="220"
                                     IsReadOnly="True"
                                     TextWrapping="Wrap"
                                     ScrollViewer.VerticalScrollBarVisibility="Auto"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <Border Grid.Column="1" Margin="12" Background="Gray">
            <Viewbox Stretch="Uniform">
                <Grid Width="{Binding PageBitmap.PixelSize.Width}" Height="{Binding PageBitmap.PixelSize.Height}">
                    <Image x:Name="PageImage"
                           Source="{Binding PageBitmap}"
                           Stretch="Uniform"
                           PointerPressed="OnPointerPressed"
                           PointerReleased="OnPointerReleased"
                           PointerMoved="OnPointerMoved"/>
                    <Canvas IsHitTestVisible="False"
                            Width="{Binding #PageImage.Bounds.Width}"
                            Height="{Binding #PageImage.Bounds.Height}">
                        <Rectangle Stroke="Orange" StrokeThickness="2"
                                   Canvas.Left="{Binding SelectLeft}"
                                   Canvas.Top="{Binding SelectTop}"
                                   Width="{Binding SelectWidth}"
                                   Height="{Binding SelectHeight}"
                                   Fill="#40FFA500"/>
                    </Canvas>
                </Grid>
            </Viewbox>
        </Border>
    </Grid>
</UserControl>
