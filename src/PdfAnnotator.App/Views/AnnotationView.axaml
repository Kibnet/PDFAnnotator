<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:viewmodels="using:PdfAnnotator.App.ViewModels"
             x:Class="PdfAnnotator.App.Views.AnnotationView"
             x:DataType="viewmodels:AnnotationViewModel">
    <Grid ColumnDefinitions="380,*">
        <Border Grid.Column="0" Padding="10" Background="#0D000000">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Spacing="10">
                    <TextBlock Text="Режим: аннотирование" FontWeight="Bold" FontSize="16"/>

                    <Border Padding="8" Background="#08000000" CornerRadius="4">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Документ" FontWeight="SemiBold"/>
                            <TextBox Watermark="Путь к PDF"
                                     IsReadOnly="True"
                                     Text="{Binding PdfPath, UpdateSourceTrigger=PropertyChanged}"
                                     HorizontalAlignment="Stretch"/>
                            <WrapPanel ItemSpacing="8" VerticalAlignment="Center">
                                <Button Content="Сменить PDF" Click="OnOpenPdfClick" Command="{Binding LoadPdfCommand}"/>
                                <TextBlock Text="{Binding PageCount, StringFormat='Страниц: {0}'}"
                                           VerticalAlignment="Center"/>
                                <NumericUpDown Minimum="1" FormatString="N0"
                                               Maximum="{Binding PageCount}"
                                               Value="{Binding CurrentPage}"/>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <Border Padding="8" Background="#08000000" CornerRadius="4">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Пресеты" FontWeight="SemiBold"/>
                            <WrapPanel ItemSpacing="8">
                                <ComboBox MinWidth="180"
                                          ItemsSource="{Binding Presets}"
                                          SelectedItem="{Binding SelectedPreset}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Name}"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <Button Content="Обновить" Command="{Binding ReloadPresetsCommand}"/>
                            </WrapPanel>
                            <TextBox Watermark="Имя пресета"
                                     Text="{Binding PresetName, UpdateSourceTrigger=PropertyChanged}"
                                     HorizontalAlignment="Stretch"/>
                            <WrapPanel ItemSpacing="8">
                                <Button Content="Сохранить" Command="{Binding SavePresetCommand}"/>
                                <Button Content="Загрузить" Command="{Binding LoadPresetCommand}"/>
                                <Button Content="Переименовать" Command="{Binding RenamePresetCommand}"/>
                                <Button Content="Удалить" Command="{Binding DeletePresetCommand}"/>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <Border Padding="8" Background="#08000000" CornerRadius="4">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Параметры текста" FontWeight="SemiBold"/>
                            <WrapPanel ItemSpacing="12">
                                <StackPanel Spacing="4">
                                    <TextBlock Text="Размер шрифта"/>
                                    <NumericUpDown Width="120" Minimum="6" Maximum="72" Value="{Binding FontSize}"/>
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="Цвет"/>
                                    <TextBox Width="120" Text="{Binding ColorHex}"/>
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="Угол"/>
                                    <NumericUpDown Width="120" Minimum="0" Maximum="360" Value="{Binding Angle}"/>
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="Шрифт"/>
                                    <ComboBox Width="200" ItemsSource="{Binding Fonts}" SelectedItem="{Binding FontName}"/>
                                </StackPanel>
                            </WrapPanel>
                            <WrapPanel ItemSpacing="12">
                                <StackPanel Spacing="4">
                                    <TextBlock Text="Координата X"/>
                                    <TextBlock Text="{Binding TextX, StringFormat=N2}"/>
                                </StackPanel>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="Координата Y"/>
                                    <TextBlock Text="{Binding TextY, StringFormat=N2}"/>
                                </StackPanel>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <Border Padding="8" Background="#08000000" CornerRadius="4">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Сохранение результата" FontWeight="SemiBold"/>
                            <Button Content="Сохранить итоговый PDF" Command="{Binding SaveAnnotatedPdfCommand}" HorizontalAlignment="Stretch"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <Border Grid.Column="1" Margin="12" Background="Gray">
            <Viewbox Stretch="Uniform">
                <Grid Width="{Binding PageBitmap.PixelSize.Width}" Height="{Binding PageBitmap.PixelSize.Height}">
                    <Image x:Name="AnnotImage"
                           Source="{Binding PageBitmap}"
                           Stretch="Fill"
                           PointerPressed="OnPointerPressed"/>
                    <Canvas IsHitTestVisible="False"
                            Width="{Binding #AnnotImage.Bounds.Width}"
                            Height="{Binding #AnnotImage.Bounds.Height}">
                        <TextBlock Text="{Binding SelectedCodePreview}"
                                   Canvas.Left="{Binding PreviewX}"
                                   Canvas.Top="{Binding PreviewY}"
                                   FontSize="{Binding FontSize}"
                                   RenderTransformOrigin="0,0">
                            <TextBlock.RenderTransform>
                                <RotateTransform Angle="{Binding Angle}"/>
                            </TextBlock.RenderTransform>
                        </TextBlock>
                    </Canvas>
                </Grid>
            </Viewbox>
        </Border>
    </Grid>
</UserControl>
